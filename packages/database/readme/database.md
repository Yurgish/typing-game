# üìä Database Schema

This project uses **MongoDB + Prisma**.  
Below is an overview of all main collections with explanations.

For convenience, the database is divided into **three logical groups**:

1. [üë§ Accounts & Authentication](#-accounts--authentication)  
   - [User](#user)  
   - [Session](#session)  
   - [Account](#account)  
   - [Verification](#verification)  

2. [üéì Lessons & Progress](#-lessons--progress)  
   - [Lesson](#lesson)  
   - [UserLessonProgress](#userlessonprogress)  
   - [ScreenMetrics](#screenmetrics)  
   - [Embedded Types: Screen & Content](#embedded-types-screen--content)  
   - [Enums: LearningMode & LessonDifficulty](#enums-learningmode--lessondifficulty)  

3. [üèÜ Activity & Achievements](#-activity--achievements)  
   - [UserStats](#userstats)  
   - [LessonDifficultyStats](#lessondifficultystats)  
   - [UserAchievement](#userachievement)  
   - [UserDailyActivity](#userdailyactivity)  
   - [CharacterMetric](#charactermetric)  

---

## üë§ Accounts & Authentication

>[!NOTE]
>All collections in this logic group are created & managed by [Better Auth](https://www.better-auth.com/).

### `User`
Main collection storing profile and account details.  
Also acts as the **parent** for related entities (sessions, stats, achievements).

| Field        | Type     | Description |
|--------------|----------|-------------|
| `id`         | String   | Unique user ID |
| `name`       | String   | User‚Äôs display name |
| `email`      | String   | Unique email |
| `emailVerified` | Boolean | Whether email is verified |
| `image`      | String?  | Optional profile picture |
| `role`       | String?  | Optional user role (e.g. `admin`) |
| `banned`     | Boolean? | If the user is banned |
| `banReason`  | String?  | Reason for ban |
| `banExpires` | DateTime?| When the ban expires |
| `createdAt`  | DateTime | Account creation timestamp |
| `updatedAt`  | DateTime | Last update timestamp |

---

### `Session`
Stores active sessions, generated by **Better Auth**.

| Field      | Type   | Description |
|------------|--------|-------------|
| `id`       | String | Session ID |
| `token`    | String | Unique token |
| `expiresAt`| DateTime | Expiry date |
| `ipAddress`| String? | Client IP |
| `userAgent`| String? | Client device/browser |
| `userId`   | String | Reference to `User` |

---

### `Account`
External authentication providers (Google, GitHub, etc.).

| Field         | Type   | Description |
|---------------|--------|-------------|
| `providerId`  | String | Provider name (`google`, `github`, ‚Ä¶) |
| `accountId`   | String | Provider-specific account ID |
| `accessToken` | String?| OAuth access token |
| `refreshToken`| String?| OAuth refresh token |
| `userId`      | String | Reference to `User` |

---

### `Verification`
Temporary tokens for email verification and password resets.

| Field       | Type     | Description |
|-------------|----------|-------------|
| `identifier`| String   | Email or identifier |
| `value`     | String   | Token value |
| `expiresAt` | DateTime | Expiration date |

---

## üéì Lessons & Progress

### `Lesson`
Stores typing lessons with ordered screens.

| Field        | Type    | Description |
|--------------|---------|-------------|
| `id`         | String  | Lesson ID |
| `title`      | String  | Lesson name |
| `difficulty` | Enum(LessonDifficulty) | Difficulty level |
| `order`      | Int     | Ordering index |
| `screens`    | [Screen](#embedded-types-screen--content)| Array of screens (see below) |

---

### `UserLessonProgress`
Tracks a user‚Äôs progress in a lesson.

| Field              | Type    | Description |
|--------------------|---------|-------------|
| `userId`           | String  | Reference ‚Üí User |
| `lessonId`         | String  | Reference ‚Üí Lesson |
| `currentScreenOrder` | Int   | Current screen index |
| `isCompleted`      | Boolean | Whether the lesson is finished |
| `rawWPM`           | Float?  | Raw typing speed |
| `adjustedWPM`      | Float?  | Adjusted speed (with errors) |
| `accuracy`         | Float?  | Accuracy percentage |
| `errors`           | Int?    | Number of errors |

---

### `ScreenMetrics`
Detailed typing metrics per lesson screen.

| Field       | Type    | Description |
|-------------|---------|-------------|
| `userLessonProgressId` | String | Reference ‚Üí UserLessonProgress |
| `screenOrder` | Int   | Which screen of the lesson |
| `rawWPM`     | Float | Raw typing speed |
| `accuracy`   | Float | Accuracy rate |
| `errors`     | Int   | Errors made |

---

### Embedded Types: `Screen` & `Content`
Each **Lesson** contains multiple screens.  
Screens represent typing exercises.

#### `Screen`
| Field   | Type         | Description |
|---------|--------------|-------------|
| `type`  | Enum(LearningMode) | Type of screen |
| `content` | Content    | Exercise content |
| `order` | Int          | Position in lesson |

#### `Content`
| Field     | Type   | Description |
|-----------|--------|-------------|
| `keyCode` | String?| Single key (e.g. `"KeyA"`) |
| `sequence`| String?| Sequence of characters |
| `text`    | String?| Text paragraph |

---

### Enums: `LearningMode` & `LessonDifficulty`

#### `LearningMode`
Defines **how the screen looks**:
- `KEY_INTRODUCTION` ‚Üí introduces a single key  
- `LETTER_SEQUENCE` ‚Üí repeating sequence of characters  
- `DEFAULT` ‚Üí free text  

#### `LessonDifficulty`
Defines **difficulty level** for lesson:
- `BEGINNER`  
- `INTERMEDIATE`  
- `ADVANCED`

---

## üèÜ Activity & Achievements

### `UserStats`
Aggregated statistics for a user.

| Field          | Type   | Description |
|----------------|--------|-------------|
| `totalExperience` | Int | Total XP earned |
| `currentLevel` | Int | Current level |
| `highestOverallWPM` | Float | Highest typing speed |
| `currentStreak` | Int | Current daily streak |
| `longestStreak` | Int | Longest streak |

---

### `LessonDifficultyStats`
Stats grouped by lesson difficulty.

| Field         | Type  | Description |
|---------------|-------|-------------|
| `difficulty`  | Enum(LessonDifficulty) | Which difficulty |
| `lessonsCompleted` | Int | Number of completed lessons |
| `perfectLessons` | Int | Lessons with 100% accuracy |
| `highestWPM`  | Float | Best speed |

---

### `UserAchievement`
Stores unlocked achievements.

| Field          | Type   | Description |
|----------------|--------|-------------|
| `achievementId`| String | ID of the achievement |
| `unlockedAt`   | DateTime | When unlocked |

---

### `UserDailyActivity`
Daily activity tracker.

| Field            | Type   | Description |
|------------------|--------|-------------|
| `date`           | DateTime | The day |
| `lessonsCompleted` | Int  | Lessons completed that day |
| `screensCompleted` | Int  | Screens completed |
| `xpEarnedToday`   | Int  | XP earned |

---

### `CharacterMetric`
Tracks typing performance per character.

| Field      | Type   | Description |
|------------|--------|-------------|
| `character`| String | The character typed |
| `correctCount` | Int | Times typed correctly |
| `errorCount`   | Int | Times mistyped |

---
